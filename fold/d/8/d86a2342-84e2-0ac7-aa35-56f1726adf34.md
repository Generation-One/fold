---
id: d86a2342-84e2-0ac7-aa35-56f1726adf34
title: session_auth.rs
author: system
file_path: src/middleware/session_auth.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:05:45.372775Z
updated_at: 2026-02-03T08:05:45.372775Z
---

//! Session-based authentication middleware.
//!
//! Validates session cookies for web UI access. Used by the admin dashboard
//! and other browser-based interactions.
//!
//! # Session Flow
//!
//! 1. User authenticates via OIDC provider
//! 2. Server creates session and sets `fold_session` cookie
//! 3. Subsequent requests include cookie, validated by this middleware
//! 4. Session expires after configured duration or on logout
//!
//! # Security Model
//!
//! - Session IDs are cryptographically random (nanoid)
//! - Sessions are stored server-side in database
//! - Cookie is HttpOnly, Secure (in production), SameSite=Lax
//! - Sessions can be invalidated server-side (logout, security events)

use axum::{
    body::Body,
    extract::{Request, State},
    middleware::Next,
    response::Response,
    Extension,
};
use axum_extra::extract::CookieJar;
use sqlx::FromRow;

use crate::{config::config, error::Error, AppState};

/// Session cookie name.
pub c