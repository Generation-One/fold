---
id: d8ec7fd9-432d-0a0d-d512-636cf7cd4793
title: API Token Authentication Middleware
author: system
tags:
- middleware
- auth
- async
- database
- http
- validation
file_path: src/middleware/token_auth.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:37:11.648833500Z
updated_at: 2026-02-03T08:37:11.648833500Z
---

This file implements Bearer token authentication middleware for the Fold API, validating tokens from the Authorization header for programmatic access by MCP clients, CLI tools, and webhooks. It provides two middleware functions: `require_token` for general token validation and `require_project_token` for project-scoped access control. The implementation uses a two-part token format (prefix for fast lookup, hash for verification) with support for token expiration, revocation, and project-level scoping, following a security-first approach with timing-safe comparisons and asynchronous last-used timestamp updates.