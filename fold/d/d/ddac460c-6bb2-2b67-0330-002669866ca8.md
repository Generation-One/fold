---
id: ddac460c-6bb2-2b67-0330-002669866ca8
title: webhooks.rs
author: system
file_path: src/api/webhooks.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:05:11.855440500Z
updated_at: 2026-02-03T08:05:11.855440500Z
---

//! Webhooks Routes
//!
//! Webhook handlers for file source providers (GitHub, GitLab, etc.).
//!
//! Uses the FileSourceProvider abstraction for signature verification
//! and event parsing, allowing new providers to be added easily.
//!
//! Routes:
//! - POST /webhooks/github/:repo_id - Handle GitHub webhook
//! - POST /webhooks/gitlab/:repo_id - Handle GitLab webhook

use axum::{
    body::Bytes,
    extract::{Path, State},
    http::{HeaderMap, StatusCode},
    response::IntoResponse,
    routing::post,
    Json, Router,
};
use chrono::Utc;
use hmac::{Hmac, Mac};
use serde::{Deserialize, Serialize};
use sha2::Sha256;
use uuid::Uuid;

use crate::services::FileSourceProvider;
use crate::{db, AppState, Error, Result};

type HmacSha256 = Hmac<Sha256>;

/// Build webhook routes.
pub fn routes() -> Router<AppState> {
    Router::new()
        .route("/github/:repo_id", post(handle_github_webhook))
        .route("/gitlab/:repo_id", post(handle_gitlab_we