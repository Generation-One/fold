---
id: b3b88a13-307c-ae87-0085-140b234b2abc
title: metadata_sync.rs
author: system
file_path: src/services/metadata_sync.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:06:57.676682100Z
updated_at: 2026-02-03T08:06:57.676682100Z
---

//! Metadata Sync Service
//!
//! Syncs Fold metadata back to repositories as Markdown files in a `.fold/` directory.
//! Commits are made as `fold-meta-bot` to distinguish them from user commits.

use std::collections::HashMap;
use std::path::{Path, PathBuf};

use chrono::Utc;
use git2::{Cred, PushOptions, RemoteCallbacks, Repository as Git2Repo, Signature};
use tracing::{debug, info};

use crate::db::{self, DbPool, Memory, MemoryLink, Repository};
use crate::error::{Error, Result};

/// Bot identity for metadata commits.
const BOT_NAME: &str = "fold-meta-bot";
const BOT_EMAIL: &str = "fold-meta-bot@noreply.fold.dev";

/// Directory in the repo where Fold metadata lives.
const FOLD_DIR: &str = ".fold";

/// Service for syncing metadata back to repositories.
#[derive(Clone)]
pub struct MetadataSyncService {
    db: DbPool,
    work_dir: PathBuf,
}

impl MetadataSyncService {
    /// Create a new metadata sync service.
    pub fn new(db: DbPool, work_dir: 