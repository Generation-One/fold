---
id: e0f08163-29b1-4227-467b-f1972afbeb22
title: auth.rs
author: system
file_path: src/services/auth.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:06:09.522912500Z
updated_at: 2026-02-03T08:06:09.522912500Z
---

//! Auth service for OIDC flows and session management.
//!
//! Handles authentication via:
//! - OIDC providers (Google, Auth0, etc.)
//! - GitHub OAuth
//! - GitLab OAuth
//! - API tokens

use std::time::Duration;

use chrono::{DateTime, Utc};
use oauth2::{
    basic::BasicClient,
    reqwest::async_http_client,
    AuthUrl, AuthorizationCode, ClientId, ClientSecret, CsrfToken, PkceCodeChallenge,
    PkceCodeVerifier, RedirectUrl, Scope, TokenResponse, TokenUrl,
};
use reqwest::Client;
use serde::{Deserialize, Serialize};
use sha2::{Sha256, Digest};
use tracing::info;

use crate::config::{AuthConfig, AuthProvider, AuthProviderType};
use crate::db::DbPool;
use crate::error::{Error, Result};
use crate::models::{ApiToken, OidcState, User, UserSession};

/// Session duration
const SESSION_DURATION_DAYS: i64 = 7;

/// OIDC state duration
const STATE_DURATION_MINUTES: i64 = 10;

/// Service for authentication and authorization.
#[derive(Clone)]
pub struct