---
id: ed0b4689-7687-1b4c-8991-a42296195dda
title: api_integration.rs
author: system
file_path: tests/api_integration.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:07:08.830531100Z
updated_at: 2026-02-03T08:07:08.830531100Z
---

//! API Integration Tests for Fold Server
//!
//! Tests the REST API endpoints using axum-test.
//! Uses in-memory SQLite and mock services where needed.

mod common;

use axum::{
    http::{header::AUTHORIZATION, HeaderValue, StatusCode},
    Router,
};
use axum_test::TestServer;
use fold::api;
use fold::config::{AuthConfig, EmbeddingConfig, LlmConfig, QdrantConfig};
use fold::db::{self, DbPool};
use fold::services::{
    AuthService, EmbeddingService, FoldStorageService, GitHubService, GitLabService,
    GitLocalService, GitService, GitSyncService, GraphService, IndexerService, LinkerService,
    LlmService, MemoryService, MetaStorageService, ProjectService, ProviderRegistry, QdrantService,
};
use fold::AppState;
use serde_json::{json, Value};
use sha2::{Digest, Sha256};
use std::sync::Arc;

/// Helper function to create a Bearer Authorization header value
fn bearer_auth(token: &str) -> HeaderValue {
    HeaderValue::from_str(&format!("Bearer {}", token)).u