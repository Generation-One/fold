---
id: e2ca8b01-5d90-0ddd-1fc3-e229b18047ad
title: db_integration.rs
author: system
file_path: tests/db_integration.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:07:14.216884800Z
updated_at: 2026-02-03T08:07:14.216884800Z
---

//! Database integration tests for Fold server.
//!
//! Tests the database CRUD operations using SQLite in-memory database.
//! Each test runs migrations and operates in isolation.

use fold::db;
use fold::Error;
use fold::Result;

// ============================================================================
// Test Setup Helper
// ============================================================================

/// Set up a fresh in-memory database with migrations applied.
async fn setup_test_db() -> db::DbPool {
    let pool = db::init_pool(":memory:").await.expect("Failed to init pool");
    db::migrate(&pool).await.expect("Failed to run migrations");
    pool
}

/// Set up database with a test project pre-created.
async fn setup_test_db_with_project() -> db::DbPool {
    let pool = setup_test_db().await;
    db::create_project(
        &pool,
        db::CreateProject {
            id: "proj-1".to_string(),
            slug: "test-project".to_string(),
   