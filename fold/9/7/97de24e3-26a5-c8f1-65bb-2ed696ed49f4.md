---
id: 97de24e3-26a5-c8f1-65bb-2ed696ed49f4
title: jobs.rs
author: system
file_path: src/db/jobs.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:05:17.211368Z
updated_at: 2026-02-03T08:05:17.211368Z
---

//! Background job and job log database queries.
//!
//! Persistent SQLite-backed job queue with:
//! - Atomic job claiming (prevents duplicate processing)
//! - Priority-based scheduling
//! - Automatic retry with exponential backoff
//! - Stale job recovery
//! - Execution history tracking

use crate::{Error, Result};
use serde::{Deserialize, Serialize};
use sqlx::FromRow;

use super::DbPool;

/// Default lock timeout in seconds (5 minutes)
const LOCK_TIMEOUT_SECS: i64 = 300;

/// Base retry delay in seconds
const BASE_RETRY_DELAY_SECS: i64 = 60;

/// Maximum retry delay in seconds (1 hour)
const MAX_RETRY_DELAY_SECS: i64 = 3600;

// ============================================================================
// Job Types
// ============================================================================

/// Job type enumeration.
#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum JobType {
   