---
id: 9732d862-43ef-95ff-ebbe-c2e4acc947c3
title: fold_storage.rs
author: system
file_path: src/services/fold_storage.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:06:31.450012600Z
updated_at: 2026-02-03T08:06:31.450012600Z
---

//! Hash-based storage service for the fold/ directory.
//!
//! Provides a storage layer that persists memories as markdown files
//! in a hash-based directory structure: fold/a/b/aBcD123.md
//!
//! Memory files use YAML frontmatter for metadata:
//! ```markdown
//! ---
//! id: aBcD123456789abc
//! title: "Memory title"
//! author: claude
//! tags:
//!   - tag1
//!   - tag2
//! file_path: src/auth/service.ts
//! language: typescript
//! memory_type: codebase
//! created_at: 2026-02-02T10:30:00Z
//! updated_at: 2026-02-02T10:30:00Z
//! related_to:
//!   - f0123456789abcde
//! ---
//!
//! Content goes here...
//! ```

use std::path::{Path, PathBuf};

use chrono::{DateTime, Utc};
use serde::{Deserialize, Serialize};
use tokio::fs;

use crate::error::{Error, Result};
use crate::models::Memory;

/// Frontmatter structure for memory files.
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct MemoryFrontmatter {
    pub id: String,
    #[serde(skip