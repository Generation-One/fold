---
id: 23f8ebc9-c03e-0650-a7dd-51ed83518b66
title: claudecode.rs
author: system
file_path: src/services/claudecode.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:06:11.406272400Z
updated_at: 2026-02-03T08:06:11.406272400Z
---

//! Claude Code credentials reader.
//!
//! Reads OAuth tokens from Claude Code's ~/.claude/.credentials.json file.
//! This allows Fold to use the same authentication as Claude Code for
//! users with a Max/Pro subscription.
//!
//! Note: This is a grey area usage - the tokens are obtained through
//! Claude Code's OAuth flow, not through a dedicated API key.

use std::path::PathBuf;

use chrono::{DateTime, Utc};
use serde::Deserialize;
use tracing::{debug, warn};

use crate::error::{Error, Result};

/// Claude Code OAuth credentials structure.
#[derive(Debug, Clone, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct ClaudeCodeOAuth {
    pub access_token: String,
    pub refresh_token: Option<String>,
    pub expires_at: Option<String>,
    pub scopes: Option<Vec<String>>,
    pub subscription_type: Option<String>,
    pub rate_limit_tier: Option<String>,
}

/// Full credentials file structure.
#[derive(Debug, Clone, Deserialize)]
#[serde(renam