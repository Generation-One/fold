---
id: 35ebfebf-02b7-3a76-de73-6734dc80b042
title: job_worker.rs
author: system
file_path: src/services/job_worker.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:06:48.074078800Z
updated_at: 2026-02-03T08:06:48.074078800Z
---

//! Background job worker for processing indexing tasks.
//!
//! Persistent SQLite-backed job queue with:
//! - Atomic job claiming (prevents duplicate processing)
//! - Priority-based scheduling
//! - Automatic retry with exponential backoff
//! - Stale job recovery
//! - Execution history tracking
//! - Heartbeat to prevent job timeouts

use std::sync::Arc;
use std::time::{Duration, Instant};

use tokio::sync::RwLock;
use tokio::time::sleep;
use tracing::{debug, error, info, warn};

use crate::db::{self, DbPool, JobType, LogLevel};
use crate::error::{Error, Result};
use crate::services::{EmbeddingService, GitHubService, GitLocalService, GitSyncService, IndexerService, LlmService, MemoryService, MetadataSyncService};

/// Poll interval for checking new jobs (seconds)
const POLL_INTERVAL_SECS: u64 = 2;

/// Maximum jobs to process concurrently
const MAX_CONCURRENT_JOBS: usize = 5;

/// How often to send heartbeats (seconds)
const HEARTBEAT_INTERVAL_SECS: u64