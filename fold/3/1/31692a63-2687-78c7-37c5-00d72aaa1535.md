---
id: 31692a63-2687-78c7-37c5-00d72aaa1535
title: mcp.rs
author: system
file_path: src/api/mcp.rs
language: rust
memory_type: codebase
created_at: 2026-02-03T08:04:56.796857100Z
updated_at: 2026-02-03T08:04:56.796857100Z
---

//! MCP Routes
//!
//! Model Context Protocol (MCP) Streamable HTTP endpoint for AI assistant integration.
//!
//! Routes:
//! - GET /mcp - SSE stream for server-to-client messages
//! - POST /mcp - JSON-RPC 2.0 requests from client

use std::collections::HashMap;
use std::convert::Infallible;
use std::time::{Duration, Instant};

use axum::{
    extract::State,
    http::{HeaderMap, StatusCode},
    middleware,
    response::{
        sse::{Event, KeepAlive, Sse},
        IntoResponse, Response,
    },
    routing::get,
    Json, Router,
};
use futures::stream::StreamExt;
use once_cell::sync::Lazy;
use serde::{Deserialize, Serialize};
use serde_json::Value;
use tokio::sync::{broadcast, RwLock};
use tokio_stream::wrappers::BroadcastStream;

use crate::db;
use crate::middleware::require_token;
use crate::models::{MemoryCreate, MemorySource, MemoryType};
use crate::{AppState, Error, Result};

// ===========================================================